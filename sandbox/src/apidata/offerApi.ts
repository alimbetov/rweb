// src/api/offerApi.ts
import apiClient from "./apiClient";
import { OfferFormDTO } from "../types/types"; // –ø—É—Ç—å –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è
import { AxiosResponse } from "axios";


apiClient.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem("token");
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);
/**
 * üîÅ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –æ—Ñ—Ñ–µ—Ä–∞ (POST /api/offers/generate)
 */
export const generateOfferForm = async (productId: number): Promise<OfferFormDTO> => {
  const response: AxiosResponse<OfferFormDTO> = await apiClient.post(
    "/api/offers/generate",
    null,
    {
      params: { productId },
    }
  );
  return response.data;
};

/**
 * üíæ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–∞ (PUT /api/offers/update)
 */
export const updateOfferForm = async (offer: OfferFormDTO): Promise<OfferFormDTO> => {
  const response: AxiosResponse<OfferFormDTO> = await apiClient.put(
    "/api/offers/update",
    offer
  );
  return response.data;
};

/**
 * üì• –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π (GET /api/offers/filter)
 */
export const fetchFilteredOffers = async (params: {
  productId?: number;
  status?: string;
  other?: boolean;
  page?: number;
  size?: number;
  sort?: string;
}): Promise<{
  content: OfferFormDTO[];
  totalElements: number;
  totalPages: number;
}> => {
  const response = await apiClient.get("/api/offers/filter", { params });
  return response.data;
};